<script type="text/html" id="SetupProperty">
<%
	var FormData = data.data || {};
%>
<div class="step-pane" id="Assets">
	<div class="block-transparent">
		<div class="header">
			<h3>房产 <%if (data.canEdit) {%><button type="button" class="btn btn-default" data-hook="property-import"><i class="fa fa-sign-in"></i> 导入现有房产</button><%}%></h3>
		</div>
		<div class="content">
			<div class="list-group tickets" id="PropertyBase">
				<%
					var Property = FormData.Assets||[];
					var i=0, l = Property.length||1;
					for(; i < l; ++i) {
				%>
					<%=this.PropertyItem({
						type:FormData.Type,
						property:Property[i],
						canEdit:data.canEdit
					})%>
				<%
					}
				%>
			</div>
			<%if (data.canEdit) {%>
			<button type="button" class="btn btn-success" data-hook="property-add">&nbsp;&nbsp;<i class="fa fa-plus"></i> 增加房产&nbsp;&nbsp;</button>
			<%}%>
		</div>
	</div>

	<%if (data.canEdit) {%>
	<div class="form-group">
		<div class="text-center col-sm-12">
			<button class="btn btn-default wizard-previous"><i class="fa fa-caret-left"></i> 上一步</button>
			&nbsp;&nbsp;
			<button class="btn btn-primary wizard-next">下一步 <i class="fa fa-caret-right"></i></button>
		</div>
	</div>
	<%}%>
</div>
</script>


<script type="text/html" id="PropertyItem">
<%
	//这个模板在setup.property.js里面也有用到，不好直接传FormData，改的时候注意
	var Former = require('risk/components/former/index');

	var PropertyData = data.property,
		FormType = data.type*1;
%>
	<div class="list-group-item">
		<div class="j-property-form">

			<%=Former.make(require('risk/page/Property/tpl.view'),{
				data:PropertyData,
				disabled:!data.canEdit,
				tplFilter:function(tpl) {
					var rs = $.extend({},tpl);
						name = tpl.name || (tpl.type=='label' && tpl.html),
						type = FormType;

					//贷前垫资/首期款垫资，有一手楼，没有房产证号等信息（房产地址必须填）
					switch(type) {
						case 2: //首期款垫付
						case 4: //贷前垫资
							if ($.inArray(name, ['Address','房产地址','Position']) == -1) {
								rs.required = false;
							}
							break;
					}
					//console.log('tplFilter:::',name,type,rs);

					return rs;
				}
			})%>

			<%/**手动增加一个备注表单**/%>
			<%=Former.make([[{
				type:'label',
				col:2,
				html:'备注'
			},{
				col:'10',
				type:'textarea',
				name:'Remark',
				placeholder:''
			}]],{
				data:PropertyData,
				disabled:!data.canEdit
			})%>

		</div>
		<div class="form-group">
			<%
				var Joint = PropertyData&&PropertyData.Joint || [],
					JointLen = Joint.length;
				console.log('Joint',Joint);
			%>
			<div class="col-sm-2">&nbsp;</div>
			<div class="col-sm-10">
				<%if (data.canEdit) {%><button type="button" data-hook="joint-add" class="btn btn-default btn-xs"><i class="fa fa-plus"></i> 增加共权人</button><%}%>
				&nbsp;&nbsp;
				<%=(JointLen||data.canEdit)?'(房产共权人、保证人、配偶、辅助联系人、第三方借款人)':''%>
			</div>
			<div class="col-sm-2">&nbsp;</div>
			<div class="col-sm-10">
				<table class="no-border no-strip j-property-joint" style="background-color:#E8E8E8;margin-top:10px; <%=JointLen?'':'display:none;'%>">
					<thead class="no-border">
						<tr>
							<th>&nbsp;</th>
							<th>类型</th>
							<th>姓名</th>
							<th>电话</th>
							<th>证件号</th>
						</tr>
					</thead>
					<tbody class="no-border-x no-border-y">
						<%
							var i=0, l = JointLen;
							for(; i < l; ++i) {
						%>
							<%=this.PropertyJointItem({
								data:Joint[i],
								canEdit:data.canEdit
							})%>
						<%
							}
						%>
					</tbody>
				</table>
			</div>
		</div>
		<%if (data.canEdit) {%>
		<hr style="border-bottom:1px dashed #dadada"/>
		<div class="col-sm-offset-2">
			<button type="button" class="btn btn-danger" data-hook="property-remove">移除</button>
		</div>
		<%}%>
	</div>
</script>

<script type="text/html" id="PropertyJointItem">
	<%
		var FormData = data.data || {};
		var CreateOptions = function(opts) {
				var dataName = opts.options,
					value = opts.value;

				var rs = [],
					dictionary = require('risk/data-dictionary'),
					da = (dictionary[dataName] || []).concat([]);//concat防止原始数据被修改

				da.unshift({
					name:(opts.required?'* ':'')+(opts.remark||'请选择'),
					value:''
				});

				var i=0,cur;
				for(;cur=da[i++];) {
					rs.push('<option value="'+cur.value+'" '+((cur.value==value)?'selected':'')+'>'+cur.name+'</option>');
				}
				rs = rs.join('');
				return rs;
			};
	%>
	<tr>
		<td><%if (data.canEdit) {%><i class="pointer-item fa fa-times" data-hook="joint-remove"></i><%}%></td>
		<td>
			<select name="JointType" <%=data.canEdit?'':'disabled'%>>
				<%=CreateOptions({
					options:'共权人类型',
					value:FormData.JointType,
					remark:'请选择类型'
				})%>
			</select>
		</td>
		<td><input type="text" name="Name" value="<%=FormData.Name||''%>" placeholder="输入姓名" <%=data.canEdit?'':'disabled'%> /></td>
		<td><input type="text" name="Phone" value="<%=FormData.Phone||''%>" placeholder="输入电话" <%=data.canEdit?'':'disabled'%> /></td>
		<td><input type="text" name="IdentityCode" value="<%=FormData.IdentityCode||''%>" placeholder="输入证件号" <%=data.canEdit?'':'disabled'%> /></td>
	</tr>
</script>